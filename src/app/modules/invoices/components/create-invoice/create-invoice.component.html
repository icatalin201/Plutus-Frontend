<div class="dialog-wrapper">

    <div class="inner-wrapper">
        <h1>Create invoice
            <span *ngIf="serialName"> - {{serialName}}</span>
        </h1>

        <form [formGroup]="requestForm">
            <div formGroupName="invoice" class="flex row wrap">
                <mat-form-field appearance="fill" class="flex-5">
                    <mat-label>Client</mat-label>
                    <mat-select formControlName="partnerId" required>
                        <mat-option [value]="partner.id" *ngFor="let partner of partners">{{partner.name}}</mat-option>
                    </mat-select>
                    <mat-error>Client is required</mat-error>
                </mat-form-field>
                <mat-form-field appearance="fill" class="flex-5">
                    <mat-label>Serial</mat-label>
                    <mat-select formControlName="serialId" required>
                        <mat-option (click)="onSelectSerial(serial)"
                                [value]="serial.id"
                                *ngFor="let serial of serials">
                            {{serial.name}}
                        </mat-option>
                    </mat-select>
                    <mat-error>Serial name is required</mat-error>
                </mat-form-field>
                <mat-form-field appearance="fill" class="flex-5">
                    <mat-label>Date</mat-label>
                    <input matInput required formControlName="date" [matDatepicker]="date">
                    <mat-datepicker-toggle matSuffix [for]="date"></mat-datepicker-toggle>
                    <mat-datepicker #date></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="fill" class="flex-5">
                    <mat-label>Due date</mat-label>
                    <input matInput required formControlName="dueDate" [matDatepicker]="dueDate">
                    <mat-datepicker-toggle matSuffix [for]="dueDate"></mat-datepicker-toggle>
                    <mat-datepicker #dueDate></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="fill" class="flex-10">
                    <mat-label>Currency</mat-label>
                    <mat-select formControlName="currency" required>
                        <mat-option value="RON">RON</mat-option>
                        <mat-option value="EUR">EUR</mat-option>
                        <mat-option value="USD">USD</mat-option>
                    </mat-select>
                    <mat-error>Choose a valid type</mat-error>
                </mat-form-field>
                <div class="flex-10 pt-1 pb-1 flex row justify-between align-center">
                    Invoice Lines
                    <button type="button" mat-button color="primary" (click)="addLine()">Add line</button>
                </div>
                <div class="invoice-line-wrapper pb-2">
                  <table mat-table [dataSource]="lines">
                    <ng-container matColumnDef="item">
                      <th mat-header-cell *matHeaderCellDef> Item </th>
                      <td mat-cell *matCellDef="let element"> {{element.item.name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="price">
                      <th mat-header-cell *matHeaderCellDef> Price </th>
                      <td mat-cell *matCellDef="let element"> {{element.price.toFixed(2)}} </td>
                    </ng-container>
                    <ng-container matColumnDef="quantity">
                      <th mat-header-cell *matHeaderCellDef> Quantity </th>
                      <td mat-cell *matCellDef="let element"> {{element.quantity}} </td>
                    </ng-container>
                    <ng-container matColumnDef="uom">
                      <th mat-header-cell *matHeaderCellDef> UoM </th>
                      <td mat-cell *matCellDef="let element"> {{element.uom}} </td>
                    </ng-container>
                    <ng-container matColumnDef="vat">
                      <th mat-header-cell *matHeaderCellDef> VAT </th>
                      <td mat-cell *matCellDef="let element"> {{element.vat}} </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnLinesToDisplay"></tr>
                    <tr mat-row *matRowDef="let row; columns: columnLinesToDisplay;"></tr>
                  </table>
                </div>
            </div>
        </form>

        <div class="flex row justify-end">
          <button mat-button color="primary" (click)="create()" [disabled]="requestForm.invalid || loading">Save</button>
          <button mat-button color="warn" (click)="dismiss()">Cancel</button>
        </div>
    </div>

    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

</div>
